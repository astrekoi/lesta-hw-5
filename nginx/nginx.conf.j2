events {
    worker_connections {{ worker_connections | default(1024) }};
}

http {
    upstream backend {
        server backend:{{ API_PORT }};
        {% if keepalive is defined %}
        keepalive {{ keepalive }};
        {% endif %}
    }

    server {
        listen {{ NGINX_LISTEN_PORT }};
        {% if ssl_enabled %}
        listen 443 ssl;
        ssl_certificate {{ ssl_cert_path }};
        ssl_certificate_key {{ ssl_key_path }};
        {% endif %}

        location / {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            {% for header in additional_headers %}
            proxy_set_header {{ header.name }} "{{ header.value }}";
            {% endfor %}
        }
    }
}
